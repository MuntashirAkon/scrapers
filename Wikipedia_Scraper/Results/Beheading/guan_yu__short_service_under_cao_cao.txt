Liu Bei and his men followed Cao Cao back to the imperial capital Xu (許; present-day Xuchang, Henan) after their victory over Lü Bu at the Battle of Xiapi in 198. About a year later, in 199, Liu Bei and his followers escaped from Xu on the pretext of helping Cao Cao lead an army to attack Yuan Shu. Liu Bei went to Xu Province, killed the provincial inspector Che Zhou (車冑), and seized control of the province. He moved to Xiaopei (小沛; present-day Pei County, Jiangsu) and left Guan Yu in charge of the provincial capital Xiapi (下邳; present-day Pizhou, Jiangsu).[Sanguozhi 4] [Sanguozhi others 2][Sanguozhi zhu 2] 
In 200, Cao Cao led an eastern campaign against Liu Bei, defeated the latter in battle, and retook Xu Province. Liu Bei fled to northern China and found refuge under Cao Cao's rival Yuan Shao. Guan Yu was captured by Cao Cao's forces and brought back to Xu. Cao Cao treated Guan Yu respectfully and asked Emperor Xian to appoint Guan as a Lieutenant-General (偏將軍).[Sanguozhi 5][Sanguozhi others 3]
Later that year, Yuan Shao sent his general Yan Liang to lead an army to attack Cao Cao's garrison at Boma (白馬; or Baima), which was defended by Liu Yan (劉延). Cao Cao sent Zhang Liao and Guan Yu to lead a vanguard force to resist the enemy. In the midst of battle, Guan Yu recognised Yan Liang's parasol so he charged towards Yan, decapitated him and returned with his head. Yuan Shao's men were unable to stop him. The siege on Boma was lifted. On Cao Cao's recommendation, Emperor Xian conferred the title "Marquis[f] of Hanshou Village" (漢壽亭侯) on Guan Yu.[Sanguozhi 6]
Cao Cao admired Guan Yu's character, but he also sensed that Guan had no intention of serving under him for long. He told Zhang Liao, "Why don't you make use of your friendship with Guan Yu to find out his objective?" When Zhang Liao asked Guan Yu, the latter replied, "I'm aware that Lord Cao treats me very generously. However, I've also received many favours from General Liu and I've sworn to follow him until I die. I cannot break my oath. I'll leave eventually, so you should help me convey my message to Lord Cao." Zhang Liao did so, and Cao Cao was further impressed with Guan Yu.[Sanguozhi 7] The Fu Zi gave a slightly different account of this incident. It stated that Zhang Liao had a dilemma on whether to convey Guan Yu's message to Cao Cao or not: if he did, Cao Cao might execute Guan Yu; if he did not, he would be failing in his service to Cao Cao. He sighed, "Lord Cao is my superior and is like a father to me; Guan Yu is like a brother to me." He eventually made his decision to tell Cao Cao. Cao Cao said, "A subject who serves a lord but does not forget his origins is truly a man of righteousness. When do you think he will leave?" Zhang Liao replied, "Guan Yu has received favours from Your Excellency. He'll most probably leave after he has repaid your kindness."[Sanguozhi zhu 3]
After Guan Yu slew Yan Liang and lifted the siege on Boma, Cao Cao knew that he would leave, so he presented Guan with greater rewards. Guan Yu sealed up all the gifts he received from Cao Cao, wrote a farewell letter, and headed towards Yuan Shao's territory to reunite with Liu Bei. Cao Cao's subordinates wanted to pursue Guan Yu, but Cao stopped them and said, "He's just doing his duty to his lord. There's no need to pursue him."[Sanguozhi 8]
Pei Songzhi commented on this as follows: "Cao Cao admired Guan Yu's character even though he knew that Guan would not remain under him. He did not send his men to pursue Guan Yu when Guan left, so as to allow Guan to fulfil his loyalty. If he did not possess the magnanimity of an overlord, how would he have allowed this to happen? This was a showcase of Cao Cao's goodness."[Sanguozhi zhu 4]
